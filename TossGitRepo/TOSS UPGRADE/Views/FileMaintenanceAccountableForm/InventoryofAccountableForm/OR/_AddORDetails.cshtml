@model TOSS_UPGRADE.Models.FM_AccountableForm.FM_AccountableFormInventory
@{
                /**/

                DB_TOSSEntities SISDB = new DB_TOSSEntities();
}
@using TOSS_UPGRADE.Models;
@using (Ajax.BeginForm("AddAccountableFormInventory", "FileMaintenanceAccountableForm", new AjaxOptions { OnSuccess = "AngularGlobalAlertsCallingNoModal('FMAccountableFormController','Get_InvtAccountableFormTable','Accountable Form Inventory Successfully Saved')", OnFailure = "OnFailure()", }))
    {
@*@using (Html.BeginForm("BulkData", "FileMaintenanceAccountableForm", FormMethod.Post))
{*@
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <div class="row">
        <div class="col-md-4 form-group" id="_ORAFID">
        </div>
        <div class="col-md-4 form-group">
            <label>Starting Stub No.</label>
            @Html.TextBoxFor(m => m.getAccountableFormInvtcolumns.StubNo, new { @class = "form-control", type = "text", id = "txtORInvStubNo" })
        </div>
        <div class="col-md-4 form-group">
            <label>Number of Stubs</label>
            @Html.TextBoxFor(m => m.getAccountableFormInvtcolumns.Quantity, new { @class = "form-control", type = "text", id = "txtORInvStub" })
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 form-group">
            <label>Starting OR</label>
            @Html.TextBoxFor(m => m.getAccountableFormInvtcolumns.StartingOR, new { @class = "form-control", type = "text", id = "txtORInvStrtOR" })
        </div>
        <div class="col-md-4 form-group">
            <label>Ending OR</label>
            @Html.TextBoxFor(m => m.getAccountableFormInvtcolumns.EndingOR, new { @class = "form-control", type = "text", id = "txtORInvEndOR", @readonly = "readonly" })
        </div>
        <div class="col-md-4 form-group">
            <label>OR Date</label>
            @Html.TextBoxFor(m => m.getAccountableFormInvtcolumns.Date, new { @class = "form-control pickadate", type = "text", id = "txtORInvDate" })
        </div>
       

    </div>
    <div class="row">
        <div class="col-md-8"></div>
        <div class="col-md-2">
            <button type="button" class="btn black bg-addbutton form-control" id="show-button" onclick="SaveORTable()"><b>Add</b></button>
            <button type="button" class="btn black bg-addbutton form-control" onclick="SaveBulk()" id=""><b>Submit</b></button>
            <button type="submit" class="btn black bg-addbutton form-control d-none" id="btnSave"><b>Submit</b></button>
        </div>
        <div class="col-md-2"><button type="reset" class="btn white bg-headerbc form-control" id="hide-button"><b>Cancel</b></button></div>
    </div>
    <div class="" id="NewOR"></div>
}
<style>
    #show-button {
        cursor: pointer;
    }

    #_SaveButtonID {
        cursor: pointer;
        display: none;
    }
</style>
<script>
    $(function () {
        LoadDataTable();
        LoadPopOver();
        LoadPickDatetime();
    })
    $("#txtORInvStrtOR").change(function () {
        var startNo = $("#txtORInvStrtOR").val();
        var countStartNo = startNo.toString().length;
        var qty = "50";
        var startNoQty = parseFloat($("#txtORInvStrtOR").val()) + parseFloat($("#txtORInvStub").val() * qty - parseFloat(1));
        var countEndNo = startNoQty.toString().length;
        var number = "";

        for (i = 1; i < countStartNo; i++) {
            number += "0";
        }

        var countZero = number.toString().length;
        var res = number.toString().substring(0, countZero - countEndNo) + startNoQty;

        if ($("#txtORInvStrtOR").val() == "") {
            $("#txtORInvEndOR").val("");
        } else {
            $("#txtORInvEndOR").val(res);
        }
    });
    function removeRow(e) {
        $('#ORTableID').DataTable().row($(e).parents('tr')).remove().draw(false);
    };

    //$('#show-button').click(function () {
    //    if ($('#txtORInvStub').val() < 1) {
    //        alert('Please enter number of rows to insert');
    //    } else {
    //        var StubNum = $("#txtORInvStubNo").val();
    //        var StrtStub = $("#txtORInvStrtOR").val();
    //        var EndStub = $("#txtORInvEndOR").val();
    //        var formType = $("#AFIDDD option:selected").text();
    //        var qty = "50";
    //        var isIssued = "No";
    //        var orDate = $("#txtORInvDate").val()
    //        for (i = 1; i <= $('#txtORInvStub').val(); i++) {
    //            var startStubNoF = parseFloat((qty * (StubNum - 1)) + parseFloat(StrtStub));
    //            if (startStubNoF < 0) {
    //                startStubNoF = startStubNoF * -1;
    //            }
    //            var EndStubNoF = parseFloat((startStubNoF + parseFloat(qty)) - 1);
    //            var NewRow = '<tr><td>' + formType + '</td><td>' + StubNum + '</td><td>' + startStubNoF + '</td><td>' + EndStubNoF + '</td><td>' + qty + '</td><td>' + orDate + '</td><td>' + isIssued + '</td><td><i title="Delete" class="ft-delete danger cursor-pointer font-large-1" onclick=\'removeRow(this)\'></i></td></tr >';
    //            $('#ORTableID').DataTable().row.add($(NewRow)).draw();
    //            StubNum++;
    //        }
    //    }
    //});
    var ORarray = [];
    var NewORModel = "";
    var m = 0;
    function SaveORTable() {

        var BodyContent = '';
        var x = 1;
        var qty = 50;
        var isIssued = "No";
        var StubNum = $("#txtORInvStubNo").val();
        var StrtStub = $("#txtORInvStrtOR").val();
        var EndStub = $("#txtORInvEndOR").val();
        debugger
        for (i = 1; i <= $('#txtORInvStub').val(); i++) {
            var startStubNoF = parseFloat((qty * (StubNum - 1)) + parseFloat(StrtStub));
            console.log($("#txtORInvStubNo").val());
            console.log($("#txtORInvStrtOR").val());

            if (startStubNoF < 0) {
                startStubNoF = startStubNoF * -1;
            }
            var EndStubNoF = parseFloat((startStubNoF + parseFloat(qty)) - 1);
            var ORTableDatas =
            {
                "Count": x,
                "StubNum": StubNum,
                "StrtStub": startStubNoF,
                "EndStub": EndStubNoF,
                "formType": $("#AFIDDD option:selected").text(),
                "orDate": $("#txtORInvDate").val(),
                "Quantity": qty,
                "IsIssued": isIssued,
            }
            ORarray.push(ORTableDatas);
            x++;
            StubNum++;
        }
        $.each(ORarray, function (index, value) {
         
                BodyContent += '<tr><td>' + value.formType + '</td>'
                BodyContent += '<td>' + value.StubNum + '</td>'
                BodyContent += '<td>' + value.StrtStub + '</td>'
                BodyContent += '<td>' + value.EndStub + '</td>'
                BodyContent += '<td>' + value.Quantity + '</td>'
                BodyContent += '<td>' + value.orDate + '</td>'
                BodyContent += '<td>' + value.IsIssued + '</td>'
                BodyContent += '<td><i title="Delete" class="ft-delete danger cursor-pointer font-large-1" onclick=\'removeRow(' + index + ' )  \'></i></td></tr >'
                x++;
                value.StubNum++;
        })
        $('#ORtbody').html(BodyContent);
    }
    function SaveBulk() {
        console.log(ORarray);
        debugger
        $.each(ORarray, function (index, value) {
            NewORModel += "<input type='hidden' name='Accountable[" + m + "].AF' value='" + value.formType + "' id='Date" + m + "'/>"
            NewORModel += "<input type='hidden' name='Accountable[" + m + "].Date' value='" + value.Date + "' id='Date" + m + "'/>"
            NewORModel += "<input type='hidden' name='Accountable[" + m + "].StubNo' value='" + value.StubNum + "' id='StubNo" + m + "'/>"
            NewORModel += "<input type='hidden' name='Accountable[" + m + "].StartingOR' value='" + value.startStubNoF + "' id='StartingOR" + m + "'/>"
            NewORModel += "<input type='hidden' name='Accountable[" + m + "].EndingOR' value='" + value.EndStubNoF + "' id='EndingOR" + m + "'/>"
            NewORModel += "<input type='hidden' name='Accountable[" + m + "].Quantity' value='" + value.qty + "' id='Quantity" + m + "'/>"

            $("#NewOR").html(NewORModel);
            m++;
        });
        $('#btnSave').click()
    }
</script>

